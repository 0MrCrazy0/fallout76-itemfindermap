<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit to Fallout 76 Community Map</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #0a2a2a; color: #00ff00; padding: 20px; text-align: center; }
        form { max-width: 400px; margin: 0 auto; background: #1a3c34; padding: 20px; border: 2px solid #00ff00; }
        input, textarea, button { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #00ff00; background: #000; color: #00ff00; font-family: inherit; }
        button { background: #00ff00; color: #000; font-weight: bold; cursor: pointer; }
        button:hover { background: #00cc00; }
        .pre-filled { background: #0a3a0a; padding: 10px; margin: 10px 0; text-align: left; border: 1px solid #00ff88; }
    </style>
</head>
<body>
    <h1>Submit to Community Map ‚ò¢Ô∏è</h1>
    <p>Share your marker with the wasteland! (MrCrazy will review.)</p>
    <form id="submitForm">
        <div class="pre-filled">
            <strong>Pre-filled from your marker:</strong><br>
            Location: <span id="coords"></span><br>
            Category: <span id="category"></span><br>
            Description: <span id="desc"></span>
        </div>
        <label>Your In-Game Name (optional):</label>
        <input type="text" id="playerName" placeholder="e.g., VaultDweller42">
        
        <button type="submit">Submit Marker</button>
    </form>

    <script>
    // Pre-fill from URL params
    const urlParams = new URLSearchParams(window.location.search);
    const lat = urlParams.get('lat');
    const lng = urlParams.get('lng');
    const category = urlParams.get('category') || 'misc';
    const desc = decodeURIComponent(urlParams.get('desc') || 'No description');

    // FORCE REAL EMOJI ICON ‚Äî THIS IS THE KEY!
    const categoryIcons = {
        'weapons': 'üî´', 'armor': 'üõ°Ô∏è', 'aid': 'üíâ', 'food/drink': 'üçΩÔ∏è', 'ammunition': 'üí•',
        'apparel': 'üëï', 'plans': 'üìú', 'junk': 'üóëÔ∏è', 'holotapes': 'üìÄ', 'misc': 'üìù',
        'plants': 'üåø', 'eggs': 'ü•ö', 'creatures': 'üê∫', 'vendors': 'üí∞', 'exchanges': '‚öñÔ∏è',
        'vaults': '‚öôÔ∏è', 'power armor': 'üë®‚ÄçüöÄ', 'fusion core': 'üîã', 'nuke drop zones': '‚ò¢Ô∏è',
        'nuke silos': 'üöÄ', 'magazines': 'üìö', 'bobbleheads': 'üéé', 'safe locations': 'üóÑÔ∏è',
        'terminal locations': 'üñ•Ô∏è', 'treasure maps': 'üó∫Ô∏è', 'resource deposits': '‚õèÔ∏è',
        'fishing locations': 'üé£', 'workshops': 'üîß', 'train stations': 'üöÇ', 'town locations': 'üè´',
        'event locations': 'üéâ', 'named locations': 'üö©', 'regions': 'üìç'
        };
    const icon = categoryIcons[category.toLowerCase()] || 'Miscellaneous';

    document.getElementById('coords').textContent = lat + ', ' + lng;
    document.getElementById('category').textContent = category;
    document.getElementById('desc').textContent = desc;

    document.getElementById('submitForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('playerName').value.trim() || 'Anonymous';
        const marker = {
            lat: parseFloat(lat),
            lng: parseFloat(lng),
            category: category,
            desc: desc,
            icon: icon,  // ‚Üê ALWAYS A REAL EMOJI NOW
            submittedBy: name
        };
        try {
            const response = await fetch('https://itemfinder-submit.crzymn05.workers.dev', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ type: 'submit', marker, name })
            });
            const text = await response.text();
            if (response.ok || text.includes("PR")) {
                document.body.innerHTML = `
                    <h1>THANK YOU ‚ù§Ô∏è</h1>
                    <p>Your marker was submitted!<br>MrCrazy will review it soon.</p>
                    <p><strong>Icon:</strong> ${icon}</p>
                    <a href="javascript:window.close()" style="color:#00ff88;">Close Window</a>`;
            } else {
                alert('Submit failed: ' + text);
            }
        } catch (err) {
            alert('Network error: ' + err.message);
        }
    });
</script>
</body>
</html>
