<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit to Fallout 76 Community Map</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #0a2a2a; color: #00ff00; padding: 20px; text-align: center; }
        form { max-width: 400px; margin: 0 auto; background: #1a3c34; padding: 20px; border: 2px solid #00ff00; }
        input, textarea, button { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #00ff00; background: #000; color: #00ff00; font-family: inherit; }
        button { background: #00ff00; color: #000; font-weight: bold; cursor: pointer; }
        button:hover { background: #00cc00; }
        .pre-filled { background: #0a3a0a; padding: 10px; margin: 10px 0; text-align: left; border: 1px solid #00ff88; }
    </style>
</head>
<body>
    <h1>Submit to Community Map ☢️</h1>
    <p>Share your marker with the wasteland! (MrCrazy will review.)</p>
    <form id="submitForm">
        <div class="pre-filled">
            <strong>Pre-filled from your marker:</strong><br>
            Location: <span id="coords"></span><br>
            Category: <span id="category"></span><br>
            Description: <span id="desc"></span>
        </div>
        <label>Your In-Game Name (optional):</label>
        <input type="text" id="playerName" placeholder="e.g., VaultDweller42">
        
        <button type="submit">Submit Marker</button>
    </form>

    <script>
        // Pre-fill from URL params
        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById('coords').textContent = urlParams.get('lat') + ', ' + urlParams.get('lng');
        document.getElementById('category').textContent = urlParams.get('category') || 'Misc';
        document.getElementById('desc').textContent = decodeURIComponent(urlParams.get('desc') || 'No description');

        document.getElementById('submitForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('playerName').value.trim() || 'Anonymous';
            const marker = {
                lat: parseFloat(urlParams.get('lat')),
                lng: parseFloat(urlParams.get('lng')),
                category: urlParams.get('category'),
                desc: decodeURIComponent(urlParams.get('desc')),
                submittedBy: name
            };

            try {
                const response = await fetch('https://itemfinder-submit.crzymn05.workers.dev', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'submit', marker, name })
                });
                if (response.ok) {
    document.body.innerHTML = `
        <h1>THANK YOU ❤️</h1>
        <p>Your marker was submitted!<br>MrCrazy will review it soon.</p>
        <a href="javascript:window.close()">Close</a>`;
                } else {
                    alert('Submit failed. Try again or contact MrCrazy.');
                }
            } catch (err) {
                alert('Network error. Check your connection.');
            }
        });
    </script>
</body>
</html>
