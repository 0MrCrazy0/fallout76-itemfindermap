<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>☢️Submit to Fallout 76 Community Map☢️</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background: #0a2a2a; 
            color: #00ff00; 
            padding: 20px; 
            text-align: center; 
        }
        form { 
            max-width: 400px; 
            margin: 0 auto; 
            background: #1a3c34; 
            padding: 20px; 
            border: 2px solid #00ff00; 
            box-sizing: border-box;
        }
        input, textarea, button { 
            width: 100%; 
            padding: 12px; 
            margin: 12px 0; 
            border: 2px solid #00ff00; 
            background: #000; 
            color: #00ff00; 
            font-family: inherit; 
            font-size: 16px; 
            box-sizing: border-box;
        }
        button { 
            background: #00ff00; 
            color: #000; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 18px;
        }
        button:hover { background: #00cc00; }
        .pre-filled { 
            background: #0a3a0a; 
            padding: 14px; 
            margin: 12px 0; 
            text-align: left; 
            border: 1px solid #00ff88; 
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Submit to Community Map</h1>
    <p>Share your marker with the wasteland! (MrCrazy will review.)</p>
    <form id="submitForm">
        <div class="pre-filled">
            <strong>Pre-filled from your marker:</strong><br>
            Location: <span id="coords"></span><br>
            Category: <span id="category"></span><br>
            Description: <span id="desc"></span>
        </div>

        <label>Your In-Game Name (optional):</label>
        <input type="text" id="playerName" placeholder="e.g., VaultDweller42">

        <button type="submit">Submit Marker</button>
    </form>

    <script>
    const urlParams = new URLSearchParams(window.location.search);
    const lat = urlParams.get('lat');
    const lng = urlParams.get('lng');
    const category = urlParams.get('category') || 'misc';
    const desc = decodeURIComponent(urlParams.get('desc') || 'No description');

    const categoryIcons = {
        'weapons': 'Weapon', 'armor': 'Armor', 'aid': 'Aid', 'food/drink': 'Food/Drink', 'ammunition': 'Ammo',
        'apparel': 'Apparel', 'plans': 'Plans', 'junk': 'Junk', 'holotapes': 'Holotapes', 'misc': 'Misc',
        'plants': 'Plant', 'eggs': 'Egg', 'creatures': 'Creature', 'vendors': 'Vendor', 'exchanges': 'Exchange',
        'vaults': 'Vault', 'power armor': 'Power Armor', 'fusion core': 'Fusion Core', 'nuke drop zones': 'Nuke Zone',
        'nuke silos': 'Nuke Silo', 'magazines': 'Magazine', 'bobbleheads': 'Bobblehead', 'safe locations': 'Safe',
        'terminal locations': 'Terminal', 'treasure maps': 'Treasure Map', 'resource deposits': 'Resource',
        'fishing locations': 'Fishing', 'workshops': 'Workshop', 'train stations': 'Train Station',
        'town locations': 'Town', 'event locations': 'Event', 'named locations': 'Named Location', 'regions': 'Region'
    };
    const icon = categoryIcons[category.toLowerCase()] || 'Misc';

    document.getElementById('coords').textContent = lat + ', ' + lng;
    document.getElementById('category').textContent = category;
    document.getElementById('desc').textContent = desc;

    document.getElementById('submitForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('playerName').value.trim() || 'Anonymous';
        const marker = {
            lat: parseFloat(lat),
            lng: parseFloat(lng),
            category: category,
            desc: desc,
            icon: icon,
            submittedBy: name
        };
        try {
            const response = await fetch("https://itemfinder-submit.crzymn05.workers.dev/", {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ type: 'submit', marker, name })
            });
            const text = await response.text();
            if (response.ok || text.includes("PR")) {
                document.body.innerHTML = `
                    <h1>THANK YOU</h1>
                    <p>Your marker was submitted!<br>MrCrazy will review it soon.</p>
                    <p><strong>Category:</strong> ${category}<br>
                    <strong>Icon:</strong> ${icon}</p>
                    <a href="javascript:window.close()" style="color:#00ff88; text-decoration:underline;">Close Window</a>`;
            } else {
                alert('Submit failed: ' + text);
            }
        } catch (err) {
            alert('Network error: ' + err.message);
        }
    });
    </script>
</body>
</html>
